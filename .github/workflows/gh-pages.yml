name: GitHub Pages

on:
  push:
    branches:
      - main
    paths:
      - 'assets/**'
      - 'content/**'
      - 'data/**'
      - 'i18n/**'
      - 'layouts/**'
      - 'static/**'
      - 'themes/**'
      - 'hugo.*'

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: "0.140.2"
          extended: true

      - name: Build
        run: hugo --minify --buildDrafts=false

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: ${{ github.ref == 'refs/heads/main' }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages
          publish_dir: ./public

      - name: Notify
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          format: markdown
          message: |
            üìù *–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–ª–æ–≥–∞!*
            
            ‚úÖ *–°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞.*

            *–ê–≤—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:* ${{ github.actor }}
            *–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞:* ${{ github.event.head_commit.message }}
            *URL –∫–æ–º–º–∏—Ç–∞:* [–°–º–æ—Ç—Ä–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub](${{ github.event.head_commit.url }})

            *–í–µ—Ç–∫–∞:* ${{ github.ref_name }}
            *–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:* https://github.com/${{ github.repository }}

            üöÄ –°–∞–π—Ç –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ GitHub Pages!
      
      - name: Notify Failure
        if: failure()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: https://github.com/${{ secrets.TELEGRAM_TOKEN }}
          format: markdown
          message: |
            ‚ùå *–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–ª–æ–≥–∞!*
            
            *–ê–≤—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:* ${{ github.actor }}
            *–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞:* ${{ github.event.head_commit.message }}
            *URL –∫–æ–º–º–∏—Ç–∞:* [–°–º–æ—Ç—Ä–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub](${{ github.event.head_commit.url }})

            *–í–µ—Ç–∫–∞:* ${{ github.ref_name }}
            *–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:* ${{ github.repository }}

            ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∂—É—Ä–Ω–∞–ª —Å–±–æ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏.


